{% extends 'tweets/base.html' %}

{% block head_title %}
Amazing 
{% endblock head_title %}

{% block content %}

<div class="row text-center">
  <div class="col">
    <h1>Welcome to Babble</h1>
  </div>
</div>
<div class='row mb-3'>
  <div class='col-md-4 mx-auto col-10'> 
    <form class='form' action="/create-tweet" method="post"> 
      {% csrf_token %}
      <input type="hidden" value="/" name="next" >
      <textarea class="form-control" name="content" placeholder="Your Tweet" cols="40" rows="5"></textarea>
      <button type='submit' class='btn btn-secondary'>Tweet</button>
    </form>

  </div>

</div>
<div class="row" id='tweets'>
  Loading...
</div>

<script>
  const tweetsElement = document.getElementById("tweets")
  // tweetsElement.innerHTML = 'Loading...'
  // var el1 = "<h1>Hi There</h1>"
  // var el2 = "<h1>Hi There 2</h1>"
  // var el3 = "<h1>Hi There 3</h1>"
  // tweetsElement.innerHTML = el1 + el2 + el3  
  const xhr = new XMLHttpRequest() //xhr = someClass()
  const method ='GET'
  const url ='/babbles'
  const responseType ='json'

function handleDidLike(tweet_id,currentCount){
  console.log(currentCount)
}

function LikeBtn(tweet){
  return "<button class='btn btn-primary' onclick=handleDidLike("+tweet.id + "," +tweet.likes+")>"+tweet.likes+" Like</button>"
}

function formatTweetElement(tweet){

  var formattedTweet ='<div class = " col-12 border mb-4 py-3 tweet" id="tweet-'+tweet.id+'">'+ 
  '<p>' 
  + tweet.content 
  +'</p><div class="btn-group">'
  + LikeBtn(tweet)
  +'</div></div>'
  return formattedTweet
}
  xhr.responseType = responseType
  xhr.open(method,url)
  xhr.onload = function(){
    const serverResponse = xhr.response
    var listedItems = serverResponse.response
    var finalTweetStr = ""
    var i
    for (i=0;i<listedItems.length;i++){
      console.log(listedItems[i])
      var tweetObj = listedItems[i]
      // var currentItem ='<div class = "mb-4" ><h1>' + listedItems[i].id +'</h1>' + '<p>' + listedItems[i].content +'</p></div>'
      var currentItem = formatTweetElement(tweetObj)
      finalTweetStr += currentItem
    }
    tweetsElement.innerHTML = finalTweetStr
    console.log(xhr.response)
  }
  xhr.send()
</script>
{% endblock content %}